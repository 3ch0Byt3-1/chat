<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CyberChat Advanced</title>
  <style>
    :root {
      --primary: #00ffcc;
      --secondary: #ff00aa;
      --bg-dark: #0c0c0c;
      --bg-medium: #111;
      --bg-light: #1a1a1a;
      --text: #f0f0f0;
      --glow: 0 0 10px currentColor, 0 0 20px currentColor;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: var(--bg-dark);
      color: var(--text);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    .chat-container {
      width: 100%;
      max-width: 500px;
      height: 100vh;
      max-height: 900px;
      display: flex;
      flex-direction: column;
      background: var(--bg-medium);
      border: 1px solid #ffffff22;
      box-shadow: 0 0 30px #00ffcc33;
      overflow: hidden;
      position: relative;
    }

    .chat-header {
      padding: 20px;
      background: var(--bg-light);
      border-bottom: 1px solid #ffffff15;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: bold;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: var(--glow);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      font-size: 0.9rem;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #00ff00;
      margin-right: 8px;
      box-shadow: 0 0 10px #00ff00;
    }

    .chat-box {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
      scrollbar-width: thin;
      scrollbar-color: var(--primary) transparent;
    }

    .chat-box::-webkit-scrollbar {
      width: 6px;
    }

    .chat-box::-webkit-scrollbar-thumb {
      background-color: var(--primary);
      border-radius: 3px;
    }

    .message {
      max-width: 80%;
      padding: 12px 18px;
      border-radius: 20px;
      position: relative;
      animation: fadeIn 0.3s ease-out;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    .user-message {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--primary), #009688);
      color: #000;
      border-bottom-right-radius: 5px;
    }

    .bot-message {
      align-self: flex-start;
      background: var(--bg-light);
      color: var(--text);
      border: 1px solid #ffffff22;
      border-bottom-left-radius: 5px;
    }

    .timestamp {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 5px;
      display: block;
      text-align: right;
    }

    .chat-input-area {
      padding: 15px;
      background: var(--bg-light);
      border-top: 1px solid #ffffff15;
      display: flex;
      gap: 10px;
    }

    #message-input {
      flex: 1;
      padding: 12px 20px;
      background: var(--bg-dark);
      border: 1px solid #ffffff22;
      border-radius: 30px;
      color: var(--text);
      font-size: 1rem;
      outline: none;
      transition: all 0.3s;
    }

    #message-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 15px var(--primary);
    }

    .send-button {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.2rem;
    }

    .send-button:hover {
      transform: scale(1.05);
      box-shadow: var(--glow);
    }

    .json-controls {
      display: flex;
      gap: 10px;
      padding: 15px;
      background: var(--bg-medium);
      border-top: 1px solid #ffffff15;
    }

    .json-btn {
      flex: 1;
      padding: 12px;
      background: var(--bg-light);
      border: 1px solid var(--primary);
      color: var(--primary);
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }

    .json-btn:hover {
      background: var(--primary);
      color: #000;
      box-shadow: var(--glow);
    }

    .auto-save-status {
      padding: 10px 15px;
      background: var(--bg-light);
      border-top: 1px solid #ffffff15;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
    }

    .save-indicator {
      color: var(--primary);
      display: flex;
      align-items: center;
    }

    .save-indicator .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--primary);
      margin-right: 8px;
      box-shadow: 0 0 5px var(--primary);
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(0, 255, 204, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(0, 255, 204, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 255, 204, 0); }
    }

    /* Responsive Design */
    @media (max-width: 600px) {
      .chat-container {
        height: 100vh;
        max-height: none;
        border-radius: 0;
      }
      
      .chat-header {
        padding: 15px;
      }
      
      .logo {
        font-size: 1.2rem;
      }
      
      .message {
        max-width: 90%;
      }
      
      .json-controls {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      <div class="logo">CYBERCHAT v3.0</div>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span>ONLINE</span>
      </div>
    </div>
    
    <div class="chat-box" id="chat-box">
      <div class="message bot-message">
        Welcome to CyberChat! All messages are auto-saved to JSON every 30 seconds.
        <span class="timestamp">System • Just now</span>
      </div>
    </div>
    
    <div class="chat-input-area">
      <input type="text" id="message-input" placeholder="Type your message..." autocomplete="off">
      <button class="send-button" id="send-btn">➤</button>
    </div>
    
    <div class="auto-save-status">
      <div class="save-indicator">
        <div class="dot"></div>
        <span id="save-status">Auto-saving to chat.json...</span>
      </div>
      <div id="last-save">Last save: Just now</div>
    </div>
    
    <div class="json-controls">
      <button class="json-btn" id="export-btn">EXPORT CHAT</button>
      <button class="json-btn" id="import-btn">IMPORT CHAT</button>
      <button class="json-btn" id="view-btn">VIEW JSON</button>
      <input type="file" id="import-file" accept=".json" style="display: none;">
    </div>
  </div>

  <script>
    // DOM Elements
    const chatBox = document.getElementById('chat-box');
    const messageInput = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');
    const exportBtn = document.getElementById('export-btn');
    const importBtn = document.getElementById('import-btn');
    const viewBtn = document.getElementById('view-btn');
    const importFile = document.getElementById('import-file');
    const saveStatus = document.getElementById('save-status');
    const lastSave = document.getElementById('last-save');

    // Chat data
    let messages = [];
    let autoSaveInterval;
    let lastSaveTime = new Date();

    // Initialize chat
    function initChat() {
      loadChatData();
      renderMessages();
      setupEventListeners();
      startAutoSave();
    }

    // Load chat data from localStorage
    function loadChatData() {
      const savedData = localStorage.getItem('chatData');
      if (savedData) {
        try {
          const parsedData = JSON.parse(savedData);
          messages = parsedData.messages || [];
          
          // Show confirmation
          const confirmation = document.createElement('div');
          confirmation.classList.add('message', 'bot-message');
          confirmation.innerHTML = `Chat history loaded! ${messages.length} messages restored<span class="timestamp">System • Just now</span>`;
          chatBox.appendChild(confirmation);
        } catch (e) {
          console.error('Error loading chat data:', e);
        }
      }
      
      // Update last save time display
      updateLastSaveDisplay();
    }

    // Save chat data to localStorage and auto-save to JSON
    function saveChatData() {
      const chatData = {
        messages,
        lastUpdated: new Date().toISOString()
      };
      
      // Save to localStorage
      localStorage.setItem('chatData', JSON.stringify(chatData));
      
      // Auto-save to JSON blob
      autoSaveToJson(chatData);
      
      // Update last save time
      lastSaveTime = new Date();
      updateLastSaveDisplay();
    }

    // Auto-save chat data to JSON blob
    function autoSaveToJson(chatData) {
      const dataStr = JSON.stringify(chatData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      
      // Create a URL for the blob
      const url = URL.createObjectURL(blob);
      
      // Store in localStorage for later retrieval
      localStorage.setItem('chatJsonUrl', url);
      localStorage.setItem('chatJsonFilename', `chat-${new Date().toISOString().slice(0, 10)}.json`);
      
      return url;
    }

    // Update last save time display
    function updateLastSaveDisplay() {
      const now = new Date();
      const diffSeconds = Math.floor((now - lastSaveTime) / 1000);
      
      if (diffSeconds < 60) {
        lastSave.textContent = `Last save: ${diffSeconds} seconds ago`;
      } else {
        const diffMinutes = Math.floor(diffSeconds / 60);
        lastSave.textContent = `Last save: ${diffMinutes} minutes ago`;
      }
    }

    // Render all messages
    function renderMessages() {
      chatBox.innerHTML = '';
      messages.forEach(msg => {
        addMessageToUI(msg.text, msg.sender, msg.timestamp);
      });
      
      // Scroll to bottom
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Add a message to the UI
    function addMessageToUI(text, sender, timestamp) {
      const messageEl = document.createElement('div');
      messageEl.classList.add('message', `${sender}-message`);
      
      const time = new Date(timestamp);
      const timeString = time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      messageEl.innerHTML = `
        ${text}
        <span class="timestamp">${sender === 'user' ? 'You' : 'System'} • ${timeString}</span>
      `;
      
      chatBox.appendChild(messageEl);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Send a new message
    function sendMessage() {
      const text = messageInput.value.trim();
      if (!text) return;
      
      const newMessage = {
        text,
        sender: 'user',
        timestamp: new Date().toISOString()
      };
      
      messages.push(newMessage);
      addMessageToUI(text, 'user', newMessage.timestamp);
      saveChatData();
      
      // Clear input
      messageInput.value = '';
      messageInput.focus();
      
      // Simulate bot response
      setTimeout(sendBotResponse, 1000);
    }

    // Send bot response
    function sendBotResponse() {
      const responses = [
        "I've saved your message to chat.json!",
        "Your message is securely stored.",
        "Data saved successfully.",
        "Message recorded in the system.",
        "Cyber systems are processing your input...",
        "Your data is now in the JSON archive."
      ];
      
      const response = responses[Math.floor(Math.random() * responses.length)];
      const botMessage = {
        text: response,
        sender: 'bot',
        timestamp: new Date().toISOString()
      };
      
      messages.push(botMessage);
      addMessageToUI(response, 'bot', botMessage.timestamp);
      saveChatData();
    }

    // Export chat to JSON
    function exportChat() {
      const chatData = {
        messages,
        meta: {
          exportedAt: new Date().toISOString(),
          messageCount: messages.length
        }
      };
      
      const dataStr = JSON.stringify(chatData, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = `chat-export-${new Date().toISOString().slice(0, 10)}.json`;
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
      
      // Show confirmation
      const confirmation = document.createElement('div');
      confirmation.classList.add('message', 'bot-message');
      confirmation.innerHTML = `Chat exported successfully!<span class="timestamp">System • Just now</span>`;
      chatBox.appendChild(confirmation);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    // View JSON data
    function viewJson() {
      const chatData = {
        messages,
        meta: {
          lastSaved: new Date().toISOString(),
          messageCount: messages.length
        }
      };
      
      const jsonStr = JSON.stringify(chatData, null, 2);
      alert(`Current Chat JSON:\n\n${jsonStr}`);
    }

    // Import chat from JSON
    function importChat() {
      importFile.click();
    }

    // Handle file selection for import
    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const importedData = JSON.parse(event.target.result);
          if (importedData.messages && Array.isArray(importedData.messages)) {
            messages = importedData.messages;
            saveChatData();
            renderMessages();
            
            // Show confirmation
            const confirmation = document.createElement('div');
            confirmation.classList.add('message', 'bot-message');
            confirmation.innerHTML = `Chat imported successfully! Loaded ${messages.length} messages.<span class="timestamp">System • Just now</span>`;
            chatBox.appendChild(confirmation);
            chatBox.scrollTop = chatBox.scrollHeight;
          } else {
            throw new Error('Invalid chat file format');
          }
        } catch (error) {
          alert('Error importing chat: ' + error.message);
        }
      };
      reader.readAsText(file);
      e.target.value = ''; // Reset input
    }

    // Start auto-save interval
    function startAutoSave() {
      // Initial save
      saveChatData();
      
      // Set up periodic saving
      autoSaveInterval = setInterval(() => {
        saveStatus.textContent = "Auto-saving to chat.json...";
        saveChatData();
        
        // Animation effect
        saveStatus.style.color = "#00ffcc";
        setTimeout(() => {
          saveStatus.style.color = "";
        }, 1000);
      }, 30000); // Save every 30 seconds
    }

    // Set up event listeners
    function setupEventListeners() {
      sendBtn.addEventListener('click', sendMessage);
      messageInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
      });
      
      exportBtn.addEventListener('click', exportChat);
      importBtn.addEventListener('click', importChat);
      viewBtn.addEventListener('click', viewJson);
      importFile.addEventListener('change', handleFileSelect);
    }

    // Initialize the chat when page loads
    window.addEventListener('DOMContentLoaded', initChat);
  </script>
</body>
</html>
